---
import { getCollection, type CollectionEntry } from 'astro:content';
import I18nLayout from '../../../layouts/I18nLayout.astro';
import { useTranslations, type Lang } from '../../../i18n/utils';
import type { TranslationFunction } from '../../../types';

// Prerender these pages as static HTML for SEO
export const prerender = true;

export async function getStaticPaths() {
  // Get all episodes for both languages
  const episodes = await getCollection('episodes');
  
  return episodes.map((episode) => ({
    params: { lang: episode.data.lang, slug: episode.slug },
    props: { episode },
  }));
}

interface Props {
  episode: CollectionEntry<'episodes'>;
}

const { episode } = Astro.props;
const { lang } = Astro.params as { lang: Lang };
const t = useTranslations(lang) as TranslationFunction;
const { Content } = await episode.render();

const formattedDate = new Intl.DateTimeFormat(lang === 'fr' ? 'fr-FR' : 'en-US', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(episode.data.publishedDate);

const allEpisodes = await getCollection('episodes', ({ data }) => {
  return data.status === 'published' && data.lang === lang;
});
const relatedEpisodes = allEpisodes
  .filter(ep => ep.data.category === episode.data.category && ep.slug !== episode.slug)
  .slice(0, 3);

// Ensure description is always a string
const pageDescription = episode.data.metaDescription || episode.data.summary;
---

<I18nLayout lang={lang} title={episode.data.metaTitle || episode.data.title} description={pageDescription}>
  <!-- Reading Progress Bar -->
  <div id="reading-progress" class="fixed top-0 left-0 w-full h-1 bg-gray-900 z-50">
    <div id="reading-progress-bar" class="h-full bg-gradient-to-r from-purple-500 via-pink-500 to-purple-500 transition-all duration-150" style="width: 0%"></div>
  </div>

  <!-- Breadcrumbs -->
  <nav class="container mx-auto px-6 py-4" aria-label="Breadcrumb">
    <ol class="flex items-center space-x-2 text-sm text-gray-400" itemscope itemtype="https://schema.org/BreadcrumbList">
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href={`/${lang === 'fr' ? '' : lang}`} class="hover:text-white transition-colors" itemprop="item">
          <span itemprop="name">{t('nav.home')}</span>
        </a>
        <meta itemprop="position" content="1" />
      </li>
      <li class="text-gray-600">/</li>
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a href={`/${lang === 'fr' ? '' : lang}/live`} class="hover:text-white transition-colors" itemprop="item">
          <span itemprop="name">{t('nav.live')}</span>
        </a>
        <meta itemprop="position" content="2" />
      </li>
      <li class="text-gray-600">/</li>
      <li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <span class="text-white" itemprop="name">{episode.data.guest.name}</span>
        <meta itemprop="position" content="3" />
      </li>
    </ol>
  </nav>

  <!-- Hero Section - Two Column Layout -->
  <section class="container mx-auto px-6 py-12">
    <div class="grid lg:grid-cols-2 gap-8 lg:gap-12 mb-16">
      <!-- Left Column: Title, Metadata, Guest -->
      <div class="flex flex-col justify-center">
        {episode.data.status === 'coming-soon' && (
          <div class="mb-4">
            <span class="px-3 py-1.5 bg-yellow-500/20 border border-yellow-500/30 text-yellow-300 rounded-lg text-xs font-semibold">
              {lang === 'fr' ? 'üìù En cours de r√©daction' : 'üìù In progress'}
            </span>
          </div>
        )}

        <!-- Category Badge -->
        <div class="mb-4">
          <span class="inline-flex items-center gap-2 px-3 py-1 bg-purple-500/20 border border-purple-500/30 text-purple-300 rounded-lg text-sm font-semibold">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"/>
            </svg>
            {episode.data.category}
          </span>
        </div>

        <!-- Title -->
        <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold text-white mb-6 leading-tight">
          {episode.data.title}
        </h1>

        <!-- Metadata -->
        <div class="flex flex-wrap items-center gap-4 mb-8 text-sm text-gray-400">
          <time datetime={episode.data.publishedDate.toISOString()} class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
            {formattedDate}
          </time>
          <span class="text-gray-600">‚Ä¢</span>
          <span class="flex items-center gap-2">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"/>
            </svg>
            {episode.data.duration}
          </span>
          <span class="text-gray-600">‚Ä¢</span>
          <span class="flex items-center gap-2" title={lang === 'fr' ? 'Temps de lecture estim√©' : 'Estimated reading time'}>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
            </svg>
            {Math.ceil((episode.body?.length || 5000) / 1000)} min {lang === 'fr' ? 'lecture' : 'read'}
          </span>
        </div>

        <!-- Guest Profile Card -->
        <div class="p-6 bg-white/5 border border-white/10 rounded-2xl backdrop-blur-sm">
          <div class="flex items-start gap-4 mb-4">
            <img 
              src={episode.data.guest.avatar} 
              alt={episode.data.guest.name}
              class="w-16 h-16 rounded-full border-2 border-purple-500/30 flex-shrink-0"
              loading="eager"
            />
            <div class="flex-1 min-w-0">
              <h3 class="text-lg font-bold text-white mb-1">{episode.data.guest.name}</h3>
              <p class="text-sm text-gray-400 mb-2">{episode.data.guest.role} @ {episode.data.guest.company}</p>
              <a 
                href={episode.data.guest.linkedin}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-2 text-purple-400 hover:text-purple-300 transition-colors text-sm"
              >
                <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
                LinkedIn
              </a>
            </div>
          </div>
          
          <!-- Social Share Buttons -->
          <div class="flex items-center gap-2 pt-4 border-t border-white/10">
            <span class="text-xs text-gray-500 mr-2">{lang === 'fr' ? 'Partager :' : 'Share:'}</span>
            <button 
              onclick={`window.open('https://twitter.com/intent/tweet?text=${encodeURIComponent(episode.data.title)}&url=${encodeURIComponent(Astro.url.href)}', '_blank')`}
              class="p-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg transition-all duration-300"
              aria-label="Share on Twitter"
            >
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
              </svg>
            </button>
            <button 
              onclick={`window.open('https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(Astro.url.href)}', '_blank')`}
              class="p-2 bg-white/5 hover:bg-white/10 border border-white/10 rounded-lg transition-all duration-300"
              aria-label="Share on LinkedIn"
            >
              <svg class="w-4 h-4 text-gray-400" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>

      <!-- Right Column: Video -->
      <div class="flex flex-col justify-center">
        <div class="sticky top-24">
          <div class="relative aspect-video rounded-2xl overflow-hidden bg-gray-900 border border-white/10 shadow-2xl shadow-purple-500/10">
            <lite-youtube 
              videoid={episode.data.youtube.split('v=')[1]?.split('&')[0]} 
              style={`background-image: url('https://i.ytimg.com/vi/${episode.data.youtube.split('v=')[1]?.split('&')[0]}/maxresdefault.jpg');`}
              class="w-full h-full"
            >
              <button type="button" class="lty-playbtn">
                <span class="lyt-visually-hidden">Play Video</span>
              </button>
            </lite-youtube>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Content Section - Single Column -->
  <article class="container mx-auto px-6 pb-20">
    <div class="max-w-4xl mx-auto">
      <!-- Tags -->
      <div class="mb-8 flex flex-wrap gap-2">
        {episode.data.tags.map((tag: string) => (
          <span class="px-3 py-1 bg-indigo-500/10 border border-indigo-500/30 text-indigo-300 rounded-lg text-sm">
            #{tag}
          </span>
        ))}
      </div>

      <!-- Summary -->
      <div class="mb-12 p-6 bg-gradient-to-br from-purple-500/10 to-indigo-500/10 border border-purple-500/20 rounded-2xl">
        <h2 class="text-xl font-bold text-white mb-3 flex items-center gap-2">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
          {lang === 'fr' ? 'R√©sum√©' : 'Summary'}
        </h2>
        <p class="text-gray-300 leading-relaxed">
          {episode.data.summary}
        </p>
      </div>

      <!-- Key Insights -->
      <div class="mb-12">
        <h2 class="text-2xl font-bold text-white mb-6 flex items-center gap-2">
          <svg class="w-7 h-7 text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
          </svg>
          {lang === 'fr' ? 'Points Cl√©s' : 'Key Insights'}
        </h2>
        <ul class="grid md:grid-cols-2 gap-4">
          {episode.data.keyInsights?.map((insight: string) => (
            <li class="p-4 bg-white/5 border border-white/10 rounded-xl flex items-start gap-3 hover:bg-white/10 transition-all duration-300 group">
              <svg class="w-6 h-6 text-green-400 flex-shrink-0 mt-0.5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
              <span class="text-gray-300">{insight}</span>
            </li>
          ))}
        </ul>
      </div>

      <!-- Article Content -->
      <div class="article-content max-w-none mb-12">
        <Content />
      </div>

      <!-- Project Details -->
      {episode.data.projectDetails && (
        <div class="mb-12 grid md:grid-cols-3 gap-6">
          <div class="p-6 bg-red-500/10 border border-red-500/30 rounded-xl">
            <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
              <svg class="w-5 h-5 text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              {lang === 'fr' ? 'D√©fi' : 'Challenge'}
            </h3>
            <p class="text-gray-300 text-sm">{episode.data.projectDetails.challenge}</p>
          </div>
          <div class="p-6 bg-blue-500/10 border border-blue-500/30 rounded-xl">
            <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
              <svg class="w-5 h-5 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
              </svg>
              {lang === 'fr' ? 'Solution' : 'Solution'}
            </h3>
            <p class="text-gray-300 text-sm">{episode.data.projectDetails.solution}</p>
          </div>
          <div class="p-6 bg-green-500/10 border border-green-500/30 rounded-xl">
            <h3 class="text-lg font-bold text-white mb-3 flex items-center gap-2">
              <svg class="w-5 h-5 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
              </svg>
              {lang === 'fr' ? 'R√©sultats' : 'Results'}
            </h3>
            <ul class="text-gray-300 text-sm space-y-2">
              {episode.data.projectDetails.results.map((result: string) => (
                <li class="flex items-start gap-2">
                  <svg class="w-4 h-4 text-green-400 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                  </svg>
                  {result}
                </li>
              ))}
            </ul>
          </div>
        </div>
      )}

      <!-- CTA Section -->
      <div class="mb-12 p-8 bg-gradient-to-br from-purple-600/20 to-indigo-600/20 border border-purple-500/30 rounded-2xl text-center">
        <h3 class="text-2xl font-bold text-white mb-4">
          {lang === 'fr' ? 'Envie d\'aller plus loin ?' : 'Want to go further?'}
        </h3>
        <p class="text-gray-300 mb-6 max-w-2xl mx-auto">
          {lang === 'fr' 
            ? 'D√©couvrez notre guide gratuit sur les meilleures pratiques Web3 et rejoignez une communaut√© de 1000+ builders.'
            : 'Discover our free guide on Web3 best practices and join a community of 1000+ builders.'}
        </p>
        <button
          data-open-lead-magnet
          class="px-8 py-4 bg-white text-gray-900 font-bold rounded-xl hover:scale-105 transition-transform duration-300 shadow-lg hover:shadow-purple-500/50"
        >
          {lang === 'fr' ? 'T√©l√©charger le Guide Gratuit' : 'Download Free Guide'}
        </button>
      </div>

      <!-- Related Episodes -->
      {relatedEpisodes.length > 0 && (
        <div>
          <h2 class="text-2xl font-bold text-white mb-6">
            {lang === 'fr' ? '√âpisodes Similaires' : 'Related Episodes'}
          </h2>
          <div class="grid md:grid-cols-3 gap-6">
            {relatedEpisodes.map((relatedEp) => (
              <a 
                href={`/${lang}/live/${relatedEp.slug}`}
                class="group block p-6 bg-white/5 border border-white/10 rounded-xl hover:bg-white/10 hover:border-purple-500/30 transition-all duration-300"
              >
                <img 
                  src={relatedEp.data.thumbnail} 
                  alt={relatedEp.data.title}
                  class="w-full aspect-video object-cover rounded-lg mb-4 group-hover:scale-105 transition-transform duration-300"
                  loading="lazy"
                />
                <h3 class="text-lg font-bold text-white mb-2 group-hover:text-purple-300 transition-colors line-clamp-2">
                  {relatedEp.data.title}
                </h3>
                <p class="text-sm text-gray-400 mb-3 line-clamp-2">
                  {relatedEp.data.summary}
                </p>
                <div class="flex items-center gap-3 text-sm text-gray-500">
                  <span>{relatedEp.data.guest.name}</span>
                  <span>‚Ä¢</span>
                  <span>{relatedEp.data.duration}</span>
                </div>
              </a>
            ))}
          </div>
        </div>
      )}
    </div>
  </article>

  <!-- Reading Progress Bar Script -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      const progressBar = document.getElementById('reading-progress-bar');
      if (!progressBar) return;

      const updateProgress = () => {
        const windowHeight = window.innerHeight;
        const documentHeight = document.documentElement.scrollHeight;
        const scrollTop = window.scrollY;
        
        // Calculate the progress percentage
        const scrollPercent = (scrollTop / (documentHeight - windowHeight)) * 100;
        progressBar.style.width = `${Math.min(scrollPercent, 100)}%`;
      };

      // Update on scroll
      window.addEventListener('scroll', updateProgress, { passive: true });
      
      // Initial update
      updateProgress();
    });
  </script>

  <!-- Content Enhancement Script -->
  <script is:inline>
    document.addEventListener('DOMContentLoaded', () => {
      // Enhance code blocks and technical content
      const codeBlocks = document.querySelectorAll('pre code');
      codeBlocks.forEach((block) => {
        // Add copy button
        const copyButton = document.createElement('button');
        copyButton.className = 'absolute top-2 right-2 p-2 text-xs bg-gray-700 hover:bg-gray-600 text-gray-300 rounded opacity-0 group-hover:opacity-100 transition-opacity';
        copyButton.textContent = 'Copy';
        copyButton.onclick = () => {
          navigator.clipboard.writeText(block.textContent);
          copyButton.textContent = 'Copied!';
          setTimeout(() => copyButton.textContent = 'Copy', 2000);
        };
        
        const pre = block.parentElement;
        pre.style.position = 'relative';
        pre.classList.add('group');
        pre.appendChild(copyButton);
      });

      // Add table of contents for long articles
      const headings = document.querySelectorAll('.prose h2, .prose h3');
      if (headings.length > 3) {
        const toc = document.createElement('div');
        toc.className = 'mb-8 p-6 bg-white/5 border border-white/10 rounded-2xl';
        toc.innerHTML = `
          <h3 class="text-lg font-bold text-white mb-4 flex items-center gap-2">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"/>
            </svg>
            ${lang === 'fr' ? 'Table des mati√®res' : 'Table of Contents'}
          </h3>
          <ul class="space-y-2">
            ${Array.from(headings).map((heading, index) => {
              const id = `heading-${index}`;
              heading.id = id;
              const level = heading.tagName.toLowerCase();
              const indent = level === 'h3' ? 'ml-4' : '';
              return `<li class="${indent}"><a href="#${id}" class="text-gray-400 hover:text-purple-400 transition-colors text-sm">${heading.textContent}</a></li>`;
            }).join('')}
          </ul>
        `;
        
        const articleContent = document.querySelector('.prose');
        articleContent.parentNode.insertBefore(toc, articleContent);
      }
    });
  </script>

  <!-- lite-youtube-embed script -->
  <script is:inline src="https://cdn.jsdelivr.net/npm/@justinribeiro/lite-youtube@1.5.0/lite-youtube.js"></script>
  <style is:inline>
    lite-youtube{background-color:#000;position:relative;display:block;contain:content;background-position:center center;background-size:cover;cursor:pointer;max-width:100%}
    lite-youtube::before{content:'';display:block;position:absolute;top:0;background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAADGCAYAAAAT+OqFAAAAdklEQVQoz42QQQ7AIAgEF/T/D+kbq/RWAlnQyyazA4aoAB4FsBSA/bFjuF1EOL7VbrIrBuusmrt4ZZORfb6ehbWdnRHEIiITaEUKa5EJqUakRSaEYBJSCY2dEstQY7AuxahwXFrvZmWl2rh4JZ07z9dLtesfNj5q0FU3A5ObbwAAAABJRU5ErkJggg==);background-position:top;background-repeat:repeat-x;height:60px;padding-bottom:50px;width:100%;transition:all .2s cubic-bezier(0,0,.2,1)}
    lite-youtube>.lty-playbtn{width:70px;height:46px;background-color:#212121;z-index:1;opacity:.8;border-radius:14%;transition:all .2s cubic-bezier(0,0,.2,1);border:0}
    lite-youtube>.lty-playbtn:before{content:'';border-style:solid;border-width:11px 0 11px 19px;border-color:transparent transparent transparent #fff}
    lite-youtube>.lty-playbtn,lite-youtube>.lty-playbtn:before{position:absolute;top:50%;left:50%;transform:translate3d(-50%,-50%,0)}
    lite-youtube:hover>.lty-playbtn{background-color:#f00;opacity:1}
    lite-youtube.lyt-activated{cursor:unset}
    lite-youtube.lyt-activated::before,lite-youtube.lyt-activated>.lty-playbtn{opacity:0;pointer-events:none}
    .lyt-visually-hidden{clip:rect(0 0 0 0);clip-path:inset(50%);height:1px;overflow:hidden;position:absolute;white-space:nowrap;width:1px}
    .line-clamp-2{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
    
    /* Article Content Styling */
    .article-content {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      line-height: 1.7;
      color: #e5e7eb;
    }
    
    .article-content h1,
    .article-content h2,
    .article-content h3,
    .article-content h4,
    .article-content h5,
    .article-content h6 {
      font-weight: 700;
      color: #ffffff;
      margin-top: 2rem;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    
    .article-content h1 {
      font-size: 2.5rem;
      margin-top: 3rem;
      margin-bottom: 1.5rem;
      border-bottom: 2px solid #8b5cf6;
      padding-bottom: 0.5rem;
    }
    
    .article-content h2 {
      font-size: 2rem;
      margin-top: 2.5rem;
      margin-bottom: 1.25rem;
      position: relative;
      padding-left: 1rem;
    }
    
    .article-content h2::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 4px;
      height: 1.5rem;
      background: linear-gradient(to bottom, #8b5cf6, #ec4899);
      border-radius: 2px;
    }
    
    .article-content h3 {
      font-size: 1.5rem;
      margin-top: 2rem;
      margin-bottom: 1rem;
      color: #d1d5db;
    }
    
    .article-content h4 {
      font-size: 1.25rem;
      margin-top: 1.5rem;
      margin-bottom: 0.75rem;
      color: #d1d5db;
    }
    
    .article-content p {
      margin-bottom: 1.5rem;
      color: #e5e7eb;
      line-height: 1.7;
    }
    
    .article-content a {
      color: #a78bfa;
      text-decoration: none;
      border-bottom: 1px solid transparent;
      transition: all 0.2s ease;
    }
    
    .article-content a:hover {
      color: #c4b5fd;
      border-bottom-color: #a78bfa;
    }
    
    .article-content strong {
      color: #ffffff;
      font-weight: 600;
    }
    
    .article-content em {
      color: #d1d5db;
      font-style: italic;
    }
    
    .article-content blockquote {
      border-left: 4px solid #8b5cf6;
      padding-left: 1.5rem;
      margin: 2rem 0;
      font-style: italic;
      color: #d1d5db;
      background: rgba(139, 92, 246, 0.05);
      padding: 1.5rem;
      border-radius: 0.5rem;
      position: relative;
    }
    
    .article-content blockquote::before {
      content: '"';
      font-size: 4rem;
      color: #8b5cf6;
      position: absolute;
      top: -0.5rem;
      left: 1rem;
      opacity: 0.3;
    }
    
    .article-content ul,
    .article-content ol {
      margin: 1.5rem 0;
      padding-left: 2rem;
    }
    
    .article-content ul {
      list-style: none;
    }
    
    .article-content ul li {
      position: relative;
      margin-bottom: 0.75rem;
      color: #e5e7eb;
    }
    
    .article-content ul li::before {
      content: '‚ñ∏';
      color: #8b5cf6;
      font-weight: bold;
      position: absolute;
      left: -1.5rem;
    }
    
    .article-content ol li {
      margin-bottom: 0.75rem;
      color: #e5e7eb;
    }
    
    .article-content code {
      background: rgba(139, 92, 246, 0.15);
      color: #c4b5fd;
      padding: 0.25rem 0.5rem;
      border-radius: 0.375rem;
      font-size: 0.875rem;
      font-family: 'JetBrains Mono', 'Fira Code', 'Monaco', 'Consolas', monospace;
      border: 1px solid rgba(139, 92, 246, 0.3);
    }
    
    .article-content pre {
      background: #1f2937;
      border: 1px solid #374151;
      border-radius: 0.75rem;
      padding: 1.5rem;
      margin: 2rem 0;
      overflow-x: auto;
      position: relative;
    }
    
    .article-content pre code {
      background: none;
      color: #e5e7eb;
      padding: 0;
      border: none;
      font-size: 0.875rem;
      line-height: 1.6;
    }
    
    .article-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 2rem 0;
      background: rgba(255, 255, 255, 0.02);
      border-radius: 0.75rem;
      overflow: hidden;
    }
    
    .article-content th {
      background: rgba(139, 92, 246, 0.1);
      color: #ffffff;
      font-weight: 600;
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid #374151;
    }
    
    .article-content td {
      padding: 1rem;
      border-bottom: 1px solid #374151;
      color: #e5e7eb;
    }
    
    .article-content tr:hover {
      background: rgba(255, 255, 255, 0.02);
    }
    
    .article-content img {
      max-width: 100%;
      height: auto;
      border-radius: 0.75rem;
      margin: 2rem 0;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
    }
    
    .article-content hr {
      border: none;
      height: 2px;
      background: linear-gradient(to right, transparent, #8b5cf6, transparent);
      margin: 3rem 0;
    }
  </style>

  <!-- Schema.org structured data -->
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "Article",
        "headline": episode.data.title,
        "description": episode.data.metaDescription,
        "image": episode.data.thumbnail,
        "datePublished": episode.data.publishedDate.toISOString(),
        "dateModified": (episode.data.updatedDate || episode.data.publishedDate).toISOString(),
        "author": {
          "@type": "Person",
          "name": episode.data.guest.name,
          "url": episode.data.guest.linkedin
        },
        "publisher": {
          "@type": "Organization",
          "name": "The Arch",
          "logo": {
            "@type": "ImageObject",
            "url": `${Astro.url.origin}/favicon.svg`
          }
        },
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": Astro.url.href
        }
      },
      {
        "@type": "VideoObject",
        "name": episode.data.title,
        "description": episode.data.summary,
        "thumbnailUrl": episode.data.thumbnail,
        "uploadDate": episode.data.publishedDate.toISOString(),
        "duration": `PT${episode.data.duration}`,
        "contentUrl": episode.data.youtube,
        "embedUrl": `https://www.youtube.com/embed/${episode.data.youtube.split('v=')[1]?.split('&')[0]}`
      },
      {
        "@type": "Person",
        "name": episode.data.guest.name,
        "jobTitle": episode.data.guest.role,
        "worksFor": {
          "@type": "Organization",
          "name": episode.data.guest.company
        },
        "url": episode.data.guest.linkedin
      }
    ]
  })} />
</I18nLayout>
