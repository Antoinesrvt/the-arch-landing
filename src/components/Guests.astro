---
// Guests Section Component
import { useTranslations } from '../i18n/utils';

export interface Props {
  lang: string;
}

const { lang } = Astro.props;
const t = useTranslations(lang as any);

// Guest data from the CSV
const guests = [
  {
    name: "Jérémy Asta Vola",
    company: "MORELL ALART & Associés",
    linkedin: "https://www.linkedin.com/in/jérémy-asta-vola-709921125/",
    youtube: "https://www.youtube.com/watch?v=51h0ZslJTxY",
    role: "Avocat spécialisé Web3",
    expertise: "Conformité réglementaire, RWA",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Richard Hamelin",
    company: "50Partners",
    linkedin: "https://www.linkedin.com/in/richard-hamelin-714958127/",
    youtube: "https://www.youtube.com/watch?v=Lh7fuCDHWW8",
    role: "Investisseur Web3",
    expertise: "Venture Capital, DeFi",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Gaye Florian",
    company: "Oval3",
    linkedin: "https://www.linkedin.com/in/gaye-florian-245628a6/",
    youtube: "https://www.youtube.com/watch?v=dug0mWmW_-M",
    role: "Fondateur",
    expertise: "Blockchain, Innovation",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Damien Dupont",
    company: "Shaka Biarritz",
    linkedin: "https://www.linkedin.com/in/damien-dupont/",
    youtube: "https://www.youtube.com/watch?v=HIw4f7g6aPY",
    role: "CEO",
    expertise: "Entrepreneuriat, Web3",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Louis Guthmann",
    company: "Starkware",
    linkedin: "https://www.linkedin.com/in/louisguthmann/",
    youtube: "https://www.youtube.com/watch?v=Yeq0Tma_ayQ",
    role: "Developer Relations",
    expertise: "Starknet, L2, ZK",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Gaspard Peduzzi",
    company: "APWine",
    linkedin: "https://www.linkedin.com/in/gaspardpeduzzi/",
    youtube: "https://www.youtube.com/watch?v=NVz9Hvx8gtc",
    role: "Fondateur",
    expertise: "DeFi, Yield Farming",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Elias Tazartes",
    company: "Kakarot",
    linkedin: "https://www.linkedin.com/in/elias-tazartes-a13450155/",
    youtube: "https://www.youtube.com/watch?v=8o8LA1cfdjo",
    role: "Fondateur",
    expertise: "EVM, Starknet, Rust",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Louis de Bonnecaze",
    company: "Intercellar",
    linkedin: "https://www.linkedin.com/in/louisdebonnecaze/",
    youtube: "https://www.youtube.com/watch?v=QiAz_ex1Itw",
    role: "Fondateur",
    expertise: "RWA, Wine, Tokenization",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Loïs Guilhou",
    company: "NFT Paris",
    linkedin: "https://www.linkedin.com/in/loïs-guilhou-05a03984/",
    youtube: "https://www.youtube.com/watch?v=rAlRFcOc0qk",
    role: "Fondateur",
    expertise: "NFT, Événements, Communauté",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Pierre Yves D",
    company: "Ledgity",
    linkedin: "https://www.linkedin.com/in/pierre-yves-ledgity/",
    youtube: "https://www.youtube.com/watch?v=wY8eg_YdqlE",
    role: "Fondateur",
    expertise: "Tokenization, Compliance",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Paul Arrago",
    company: "Nyx Capital DAO",
    linkedin: "https://www.linkedin.com/in/paul-arrago-b8345ab4/",
    youtube: "https://www.youtube.com/watch?v=5RC9_znw6o4",
    role: "Fondateur",
    expertise: "DAO, Investment, Governance",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Benoit Huguet",
    company: "Journal du coin, BitConseil",
    linkedin: "https://www.linkedin.com/in/benoit-huguet-bitconseil/",
    youtube: "https://www.youtube.com/watch?v=pi3IOzARxEU",
    role: "Journaliste, Consultant",
    expertise: "Média, Analyse, Formation",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Jahed Momand",
    company: "Cerulean Ventures",
    linkedin: "https://www.linkedin.com/in/jahedmomand/",
    youtube: "https://www.youtube.com/watch?v=b8XiBx1VuuM",
    role: "Managing Partner",
    expertise: "Venture Capital, Web3",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  },
  {
    name: "Thibaut Boutrou",
    company: "Meria",
    linkedin: "https://www.linkedin.com/in/thibaut-boutrou/",
    youtube: "https://www.youtube.com/watch?v=9uHQRyq_xUU",
    role: "Fondateur",
    expertise: "Investment, Web3",
    avatar: "https://media.licdn.com/dms/image/C4D03AQF8QZ8QZ8QZ8Q/profile-displayphoto-shrink_800_800/0/1516254000000?e=1756944000&v=beta&t=placeholder"
  }
];
---

<!-- Guests Section -->
<section id="guests" class="py-24 relative overflow-hidden" aria-labelledby="guests-title">
  <!-- Background gradient -->
  <div class="absolute inset-0 bg-gradient-to-b from-transparent via-purple-500/5 to-transparent" aria-hidden="true"></div>
  
  <div class="container mx-auto px-6 relative z-10">
    <div class="text-center mb-16">
      <h2 id="guests-title" class="text-4xl md:text-5xl font-bold text-white tracking-tight mb-4" set:html={t('guests.title')}></h2>
      <p class="text-lg md:text-xl text-gray-400 max-w-3xl mx-auto">
        {t('guests.subtitle')}
      </p>
    </div>

    <!-- Stats with Modern Design -->
    <!-- <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-16 max-w-5xl mx-auto">
      <div class="glass-card p-6 rounded-2xl text-center relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-20 h-20 bg-purple-500/20 rounded-full blur-2xl -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
        <div class="relative z-10">
          <div class="text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent mb-2">{guests.length}+</div>
          <div class="text-sm text-gray-400 font-medium">{t('guests.experts')}</div>
        </div>
      </div>
      <div class="glass-card p-6 rounded-2xl text-center relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-20 h-20 bg-green-500/20 rounded-full blur-2xl -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
        <div class="relative z-10">
          <div class="text-4xl font-bold bg-gradient-to-r from-green-400 to-emerald-400 bg-clip-text text-transparent mb-2">15+</div>
          <div class="text-sm text-gray-400 font-medium">{t('guests.episodes')}</div>
        </div>
      </div>
      <div class="glass-card p-6 rounded-2xl text-center relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-20 h-20 bg-blue-500/20 rounded-full blur-2xl -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
        <div class="relative z-10">
          <div class="text-4xl font-bold bg-gradient-to-r from-blue-400 to-indigo-400 bg-clip-text text-transparent mb-2">50K+</div>
          <div class="text-sm text-gray-400 font-medium">{t('guests.views')}</div>
        </div>
      </div>
      <div class="glass-card p-6 rounded-2xl text-center relative overflow-hidden group">
        <div class="absolute top-0 right-0 w-20 h-20 bg-yellow-500/20 rounded-full blur-2xl -mr-10 -mt-10 group-hover:scale-150 transition-transform duration-500"></div>
        <div class="relative z-10">
          <div class="text-4xl font-bold bg-gradient-to-r from-yellow-400 to-orange-400 bg-clip-text text-transparent mb-2">100%</div>
          <div class="text-sm text-gray-400 font-medium">{t('guests.french')}</div>
        </div>
      </div>
    </div> -->

    <!-- Native Scroll Carousel with Snap -->
    <div class="relative w-full mx-auto mb-12">
      <!-- Carousel Scroll Container -->
      <div 
        id="guests-carousel-scroll" 
        class="overflow-x-auto overflow-y-hidden scroll-smooth snap-x snap-mandatory scrollbar-hide"
        style="-webkit-overflow-scrolling: touch;"
      >
        <div class="flex gap-6 px-6 md:px-12 py-4">
          {guests.map((guest, index) => (
            <div class="flex-shrink-0 w-[85%] md:w-[70%] snap-center" data-slide={index}>
              <article class="glass-card p-8 lg:p-10 rounded-3xl relative overflow-hidden group max-w-4xl mx-auto">
                <!-- Gradient overlay -->
                <div class="absolute inset-0 bg-gradient-to-br from-purple-500/10 via-transparent to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-500" aria-hidden="true"></div>
                
                <div class="relative z-10 flex flex-col md:flex-row items-center gap-8">
                  <!-- Avatar -->
                  <div class="relative flex-shrink-0">
                    <img 
                      src={guest.avatar} 
                      alt={guest.name}
                      class="w-32 h-32 rounded-2xl border-2 border-purple-500/30 object-cover group-hover:border-purple-500/60 transition-colors duration-300"
                      onerror="this.onerror=null;this.src='https://placehold.co/128x128/1E293B/8A70D6?text=' + this.alt.charAt(0);"
                    />
                    <div class="absolute -top-3 -right-3 w-12 h-12 bg-gradient-to-br from-red-500 to-red-600 rounded-xl flex items-center justify-center shadow-lg">
                      <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M8 5v14l11-7z"/>
                      </svg>
                    </div>
                  </div>
                  
                  <!-- Content -->
                  <div class="flex-grow text-center md:text-left">
                    <h3 class="text-3xl font-bold text-white mb-2 group-hover:text-purple-300 transition-colors">{guest.name}</h3>
                    <p class="text-lg text-purple-400 font-semibold mb-2">{guest.role}</p>
                    <p class="text-base text-gray-400 mb-4">{guest.company}</p>
                    
                    <div class="flex flex-wrap gap-2 justify-center md:justify-start mb-6">
                      {guest.expertise.split(',').map((skill) => (
                        <span class="text-sm px-3 py-1.5 bg-purple-500/10 border border-purple-500/30 text-purple-300 rounded-full">
                          {skill.trim()}
                        </span>
                      ))}
                    </div>
                    
                    <div class="flex gap-3 justify-center md:justify-start">
                      <a 
                        href={guest.youtube} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="flex items-center justify-center gap-2 px-5 py-2.5 bg-red-500/10 hover:bg-red-500/20 border border-red-500/30 rounded-xl transition-all duration-300 hover:scale-105 text-red-300 font-semibold"
                        aria-label={`Voir l'épisode avec ${guest.name}`}
                      >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                        </svg>
                        <span class="hidden sm:inline">Watch Episode</span>
                      </a>
                      <a 
                        href={guest.linkedin} 
                        target="_blank" 
                        rel="noopener noreferrer"
                        class="flex items-center justify-center gap-2 px-5 py-2.5 bg-blue-500/10 hover:bg-blue-500/20 border border-blue-500/30 rounded-xl transition-all duration-300 hover:scale-105 text-blue-300 font-semibold"
                        aria-label={`Profil LinkedIn de ${guest.name}`}
                      >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
                          <path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"/>
                        </svg>
                        <span class="hidden sm:inline">LinkedIn</span>
                      </a>
                    </div>
                  </div>
                </div>
              </article>
            </div>
          ))}
        </div>
      </div>
      
      <!-- Navigation Dots -->
      <div class="flex justify-center gap-2 mt-8">
        {guests.map((_, index) => (
          <button 
            class="carousel-dot w-2.5 h-2.5 rounded-full bg-white/20 transition-all duration-300 hover:bg-white/40"
            data-slide-to={index}
            aria-label={`Go to slide ${index + 1}`}
          ></button>
        ))}
      </div>
    </div>

    <!-- Enhanced CTA -->
    <div class="text-center">
      <a 
        href={`/${lang}/live`}
        class="group relative inline-flex items-center justify-center gap-3 px-8 py-4 text-lg font-semibold text-white rounded-xl border-2 border-purple-500/30 bg-gradient-to-r from-purple-600/20 to-pink-600/20 backdrop-blur-sm overflow-hidden transition-all duration-300 hover:border-purple-500/60 hover:scale-105"
      >
        <span class="relative z-10 flex items-center gap-2">
          {t('guests.seeAll')}
          <svg class="w-5 h-5 group-hover:translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </span>
        <!-- Animated glow -->
        <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 opacity-0 group-hover:opacity-20 blur-xl transition-opacity duration-300" aria-hidden="true"></div>
      </a>
    </div>
  </div>
</section>

<script>
  // Native Scroll Carousel with Scroll-Snap
  document.addEventListener('DOMContentLoaded', () => {
    const scrollContainer = document.getElementById('guests-carousel-scroll');
    const dots = document.querySelectorAll('.carousel-dot');
    const slides = scrollContainer?.querySelectorAll('[data-slide]');
    
    if (!scrollContainer || !dots.length || !slides) return;
    
    const totalSlides = dots.length;
    let currentSlide = 0;
    let autoPlayInterval: number | null = null;
    let isUserScrolling = false;
    
    function scrollToSlide(index: number) {
      if (!slides || !scrollContainer) return;
      
      const slide = slides[index] as HTMLElement;
      if (!slide) return;
      
      // Scroll to the slide
      const scrollLeft = slide.offsetLeft - (scrollContainer.offsetWidth - slide.offsetWidth) / 2;
      scrollContainer.scrollTo({
        left: scrollLeft,
        behavior: 'smooth'
      });
      
      currentSlide = index;
      updateDots();
    }
    
    function updateDots() {
      dots.forEach((dot, index) => {
        if (index === currentSlide) {
          dot.classList.add('bg-purple-500', 'w-8');
          dot.classList.remove('bg-white/20', 'w-2.5');
        } else {
          dot.classList.remove('bg-purple-500', 'w-8');
          dot.classList.add('bg-white/20', 'w-2.5');
        }
      });
    }
    
    function getClosestSlideIndex(): number {
      if (!slides || !scrollContainer) return 0;
      
      const scrollLeft = scrollContainer.scrollLeft;
      const containerCenter = scrollLeft + scrollContainer.offsetWidth / 2;
      
      let closestIndex = 0;
      let closestDistance = Infinity;
      
      slides.forEach((slide, index) => {
        const slideElement = slide as HTMLElement;
        const slideCenter = slideElement.offsetLeft + slideElement.offsetWidth / 2;
        const distance = Math.abs(containerCenter - slideCenter);
        
        if (distance < closestDistance) {
          closestDistance = distance;
          closestIndex = index;
        }
      });
      
      return closestIndex;
    }
    
    function nextSlide() {
      const next = (currentSlide + 1) % totalSlides;
      scrollToSlide(next);
    }
    
    function startAutoPlay() {
      stopAutoPlay();
      autoPlayInterval = window.setInterval(() => {
        if (!isUserScrolling) {
          nextSlide();
        }
      }, 5000);
    }
    
    function stopAutoPlay() {
      if (autoPlayInterval) {
        clearInterval(autoPlayInterval);
        autoPlayInterval = null;
      }
    }
    
    // Handle scroll events to update active dot
    let scrollTimeout: number;
    scrollContainer.addEventListener('scroll', () => {
      isUserScrolling = true;
      clearTimeout(scrollTimeout);
      
      scrollTimeout = window.setTimeout(() => {
        currentSlide = getClosestSlideIndex();
        updateDots();
        isUserScrolling = false;
      }, 150);
    });
    
    // Dot click handlers
    dots.forEach((dot, index) => {
      dot.addEventListener('click', () => {
        scrollToSlide(index);
        stopAutoPlay();
        startAutoPlay();
      });
    });
    
    // Pause auto-play on hover
    scrollContainer.addEventListener('mouseenter', stopAutoPlay);
    scrollContainer.addEventListener('mouseleave', () => {
      if (!isUserScrolling) startAutoPlay();
    });
    
    // Keyboard navigation (Arrow keys)
    document.addEventListener('keydown', (e) => {
      // Only handle arrow keys when the carousel section is in view
      const carouselSection = document.getElementById('guests');
      if (!carouselSection) return;
      
      const rect = carouselSection.getBoundingClientRect();
      const isInView = rect.top < window.innerHeight && rect.bottom > 0;
      
      if (isInView && (e.key === 'ArrowLeft' || e.key === 'ArrowRight')) {
        e.preventDefault();
        stopAutoPlay();
        
        if (e.key === 'ArrowRight') {
          const next = (currentSlide + 1) % totalSlides;
          scrollToSlide(next);
        } else if (e.key === 'ArrowLeft') {
          const prev = (currentSlide - 1 + totalSlides) % totalSlides;
          scrollToSlide(prev);
        }
        
        // Restart auto-play after keyboard interaction
        setTimeout(() => startAutoPlay(), 1000);
      }
    });
    
    // Initialize
    updateDots();
    startAutoPlay();
    
    // Update on resize
    let resizeTimeout: number;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimeout);
      resizeTimeout = window.setTimeout(() => updateDots(), 100);
    });
  });
</script>

<style>
  /* Hide scrollbar but keep functionality */
  .scrollbar-hide {
    -ms-overflow-style: none;  /* IE and Edge */
    scrollbar-width: none;  /* Firefox */
  }
  
  .scrollbar-hide::-webkit-scrollbar {
    display: none;  /* Chrome, Safari, Opera */
  }
</style>
